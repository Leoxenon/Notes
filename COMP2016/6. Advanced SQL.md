- Advanced SQL query
	- SELECT MAX(amount)
	  FROM DEPOSIT
		- aggregate function
			- MIN, COUNT, SUM, AVG
	- SELECT acc-id, cust-id, SUM(amount)
	  FROM DEPOSIT
	  GROUP BY acc-id, cust-id
		- group by
		- constraint of group by
			- SELECT + attribute names and aggregate functions
				- attribute name must be from GROUP BY clause
				- aggregate function can take any attribute
				- have a single value pre group
	- SELECT acc-id, SUM(amount)
	  FROM DEPOSIT
	  GROUP BY acc-id
	  HAVING COUNT( * ) >= 2
		- having
		- applies only to groups
		- usually contains only aggregate functions
		- There can be no aggregate function in WHERE 
	- SELECT acc-id 
	  FROM ACC 
	  WHERE balance = (SELECT MAX(balance) FROM ACC)
		- nested query
	- SELECT acc-id 
	  FROM ACC 
	  WHERE balance > ALL (SELECT balance 
							FROM ACC WHERE cust-id = 1)
		- all
	- SELECT acc-id 
	  FROM ACC 
	  WHERE balance > SOME (SELECT balance 
							FROM ACC WHERE cust-id = 1)
		- some
		- any
	- SELECT T1.acc-id 
	  FROM ACC T1
	  WHERE EXISTS (SELECT * 
					FROM ACC T2 WHERE T1.balance < T2.balance)
		- exists
	- SELECT T1.acc-id 
	  FROM ACC T1
	  WHERE NOT EXISTS (SELECT * 
					FROM ACC T2 WHERE T1.balance < T2.balance)
		- not exists
	- SELECT acc-id 
	  FROM DEPOSIT 
	  WHERE cust-id = 2 AND acc-id IN (SELECT acc-id 
									FROM DEPOSIT 
									WHERE cust-id = 1)
		- in
	- SELECT acc-id 
	  FROM DEPOSIT 
	  WHERE cust-id = 2 AND acc-id NOT IN (SELECT acc-id 
									FROM DEPOSIT 
									WHERE cust-id = 1)
		- not in
	- SELECT AVG(wealth) 
	  FROM (SELECT SUM(balance) as wealth FROM ACC 
			GROUP BY cust-id)
		AS TMP 
	  WHERE wealth > 20000
		- nested query in FROM
	- WITH TMP AS 
			(SELECT SUM(balance) as wealth FROM ACC 
			GROUP BY cust-id) 
	  SELECT AVG(wealth) 
	  FROM TMP 
	  WHERE wealth > 20000
		- with
## **Tutorial**
![[COMP2016/6.png/Tutorial 1.png]]

```sql
SELECT AVG(age)
FROM Sailors
WHERE rating = 10
```
![[COMP2016/6.png/Tutorial 2.png]]
```sql
SELECT COUNT(DISTINCT sname)
FROM Sailors
```
![[COMP2016/6.png/Tutorial 3.png]]
```sql
SELECT MIN(age)
FROM Sailor
GROUP BY rating
```
![[COMP2016/6.png/Tutorial 4.png]]
```sql
SELECT B.bid, COUNT(*)
FROM Boats B, Reserves R
WHERE B.bid = R.bid AND color = 'red'
GROUP BY B.bid
```
![[COMP2016/6.png/Tutorial 5.png]]
```sql
SELECT *
FROM Sailors
WHERE rating > SOME (SELECT rating FROM Sailors
					WHERE sname = 'Tom')
```
![[COMP2016/6.png/Tutorial 6.png]]
```sql
SELECT *
FROM Sailors
WHERE rating > ALL (SELECT rating FROM Sailors
					WHERE sname = 'Tom')
```
![[COMP2016/6.png/Tutorial 7.png]]
```sql
SELECT *
FROM Sailors
WHERE rating <= ALL (SELECT rating FROM Sailors)
```
![[COMP2016/6.png/Tutorial 8.png]]
```sql
SELECT sname, age
FROM Sailors
WHERE age <= ALL (SELECT age FROM Sailors)
```
```sql
SELECT sname, age
FROM Sailors
WHERE age = (SELECT MIN(age) FROM Sailors)
```
![[COMP2016/6.png/Tutorial 9.png]]
```sql
SELECT sname
FROM Sailors
WHERE age > (SELECT MAX(age) FROM Sailors
				WHERE rating = 10)
```
```sql
SELECT sname
FROM Sailors
WHERE age > ALL (SELECT age FROM Sailors
				WHERE rating = 10)

```
![[COMP2016/6.png/Tutorial 10.png]]
```sql
SELECT sname
FROM Sailors S, 
WHERE EXIST (SELECT * FROM Reserves R
				WHERE S.sid = R.sid AND R.bid = 103)
```
![[COMP2016/6.png/Tutorial 11.png]]
```sql
SELECT sname 
FROM Sailors S
WHERE (SELECT COUNT(*) FROM Reserves R
		WHERE S.sid = R.sid AND R.bid = 103) <= 1
```
![[COMP2016/6.png/Tutorial 12.png]]
```sql
SELECT *
FROM Sailors S
WHERE NOT EXISTS(
	(SELECT bid FROM Boats
	WHERE color = 'red')
	EXCEPT
	(SELECT bid FROM Reserves R
	WHERE S.sid = R.sid))
```
![[COMP2016/6.png/Tutorial 13.png]]
```sql
SELECT sname
FROM Sailors S
WHERE sid IN(SELECT sid FROM Reserves
			WHERE bid = 103)
```
![[Tutorial 14.png]]
```sql
SELECT sname
FROM Sailors S
WHERE sid IN(SELECT sid FROM Reserves R
			WHERE bid IN(SELECT bid FROM Boats
						WHERE color = 'red'))
```
```sql
SELECT sname
FROM Sailors S
WHERE sid IN(SELECT sid FROM Reserves R, Boats B
			WHERE R.bid = B.bid AND color = 'red') 
```
![[Tutorial 15.png]]
```sql
SELECT sname
FROM Sailors S
WHERE sid NOT IN(SELECT sid FROM Reserves R
			WHERE bid IN(SELECT bid FROM Boats
						WHERE color = 'red'))
```
```sql
SELECT snames
FROM Sailors
WHERE sid NOT IN (SELECT sid FROM Reserves R, Boats B
				WHERE R.sid = B.sid AND color = 'red')
```
![[Tutorial 16.png]]
```sql
SELECT sname
FROM Sailors S
WHERE sid IN(SELECT sid FROM Reserves R
			WHERE bid NOT IN(SELECT bid FROM Boats
						WHERE color = 'red'))
```
![[Tutorial 17.png]]
```sql
SELECT sname
FROM Sailors S
WHERE sid NOT IN(SELECT sid FROM Reserves R
			WHERE bid NOT IN(SELECT bid FROM Boats
						WHERE color = 'red'))```
